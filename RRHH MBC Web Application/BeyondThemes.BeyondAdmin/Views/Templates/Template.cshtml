@model Model.TemplateModel
@{
    Layout = "~/Views/Shared/_Default.cshtml";
    ViewBag.Title = "Plantilla Solicitud Vacaciones";
    ViewBag.Description = "Solicitud Vacaciones";
    string name = Model.userDTO.name + " " + Model.userDTO.fLastName + " " + Model.userDTO.sLastName;
    string createdDate = Model.templateDTO.createdDate.Substring(0, 10);
}

<div class="row">
    <div class="col-xs-12">
        <div class="widget radius-bordered">
            <div class="widget-header">
                <span class="widget-caption">Plantilla Solicitud Vacaciones</span>
                <div class="widget-buttons">
                    <button class="btn btn-sky btn-sm" data-toggle="modal" data-target="#modal_addRol">Editar</button>
                </div>
                <div class="widget-buttons">
                    <button class="btn btn-danger btn-sm">Eliminar</button>
                </div>
            </div><!--Widget Header-->
            <div class="widget-body">
                <div class="row" style="font-size:14px; margin-top:25px; margin-bottom:10px">
                    <div class="col-xs-12">
                        <div class="col-md-4">
                            <dl class="dl-horizontal">
                                <dt>Creado por</dt><dd>@Html.Raw(name)</dd>
                                <dt>Creado</dt><dd>@Html.Raw(createdDate)</dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="widget-main ">
                            @using (var tabs = Html.Bootstrap().Begin(new Tabs("FlatTab").Flat()))
                            {
                                tabs.Tab("Etapas");
                                tabs.Tab("Participantes");
                                <!-- Etapas -->
                                using (tabs.BeginPanel())
                                {
                                    <div class="row">
                                        <div class="col-xs-12" style="margin-bottom:10px">
                                            <h3>Etapas</h3>
                                        </div>
                                        <div class="col-xs-9">
                                            <ul class="todo-list">
                                                <li>
                                                    <span class="handle">
                                                        <i class="fa fa-ellipsis-v"></i>
                                                        <i class="fa fa-ellipsis-v"></i>
                                                    </span>
                                                    <input type="checkbox" value="">
                                                    <span class="text">Design a nice theme</span>
                                                    <small class="label label-default"><i class="fa fa-clock-o"></i> 1 día</small>
                                                    <div class="tools" style="display:inline-block">
                                                        <a href="/Processes/Tasks">
                                                            <i class="fa fa-eye"></i>
                                                        </a>
                                                        <i class="fa fa-edit"></i>
                                                        <i class="fa fa-trash-o"></i>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-offset-8 col-md-offset-10 col-xs-offset-8" style="margin-top:15px">
                                            <button class="btn btn-success">Agregar etapa</button>
                                        </div>
                                    </div>
                                }
                                <!-- Participantes -->
                                using (tabs.BeginPanel())
                                {
                                    <div class="row" style="margin-bottom:30px">
                                        <!-- search bar -->
                                        <div class="col-md-6">
                                            <span class="input-icon">
                                                <input type="text" class="form-control" id="glyphicon-search" placeholder="Buscar">
                                                <i class="glyphicon glyphicon-search blue"></i>
                                            </span>
                                        </div>
                                        <div class="col-md-offset-3 col-md-3">
                                            <div class="col-xs-6">
                                                <button class="btn btn-success" style="float:right" data-toggle="modal" data-target="#modal_addParticipantUser">Agregar grupo</button>
                                            </div>
                                            <div class="col-xs-6">
                                                <button class="btn btn-success" style="float:right" data-toggle="modal" data-target="#modal_addParticipantUser">Agregar integrante</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <p>Mostrando 10 integrantes</p>
                                        </div>
                                    </div>
                                    <!-- Users box -->
                                    <div class="row" id="participantsListDiv">
                                        @{ Html.RenderPartial("/Views/Templates/_TemplateParticipantsList.cshtml", new Model.ParticipantsModel(Model.templateDTO.id_processManagment));}
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div><!--Widget Body-->
        </div><!--Widget-->
    </div>
</div>
@{ Html.RenderPartial("/Views/Templates/_AddParticipantUser.cshtml", new Model.AddParticipantUserModel(Model.templateDTO.id_processManagment));}
@{ Html.RenderPartial("/Views/Templates/_AddGroup.cshtml", new Model.AddGroupModel(Model.templateDTO.id_processManagment));}


@section PageScripts{
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="/assets/js/select2/select2.js"></script>
<!--Bootstrap Tags Input-->
<script src="/assets/js/tagsinput/bootstrap-tagsinput.js"></script>
    <script>
        $('#selected_userParticipants_id').select2();
        function ParticipantAddedSuccess(content) {
            if (content.usersAdded == 1) {
                Notify("Se ha agregado " + content.usersAdded.length + " usuario con éxito", 'bottom-right', '8000', 'success', 'fa-edit', true);
            }
            else if (content.usersAdded > 1){
                Notify("Se han agregado " + content.usersAdded.length + " usuarios con éxito", 'bottom-right', '8000', 'success', 'fa-edit', true);
            }
            if (content.usersError == 1) {
                Notify(content.usersError + " de los usuarios ya se encuentra como participante", 'bottom-right', '8000', 'warning', 'fa-edit', true);
            }
            else if (content.usersError.length > 1) {
                Notify(content.usersError + " de los usuarios ya se encuentran como participante", 'bottom-right', '8000', 'warning', 'fa-edit', true);
            }
            $("#participantsListDiv").html(content.viewHtml)
        }
        function ParticipantAddedFailure(content) {
            Notify("Error, no se agregó ningun usuario", 'bottom-right', '5000', 'danger', 'fa-edit', true);
        }

        function GroupAddedSuccess(content) {
            if (content.usersAdded.length == 1) {
                Notify("Se ha agregado " + content.usersAdded.length + " grupo con éxito", 'bottom-right', '8000', 'success', 'fa-edit', true);
            }
            else if (content.usersAdded.length > 1) {
                Notify("Se han agregado " + content.usersAdded.length + " grupos con éxito", 'bottom-right', '8000', 'success', 'fa-edit', true);
            }
            $("#participantsListDiv").html(content.viewHtml)
        }
        function GroupAddedFailure(content) {
            Notify("Error, no se agregó ningun grupo", 'bottom-right', '5000', 'danger', 'fa-edit', true);
        }

    (function ($) {
        'use strict';
        $.fn.todolist = function (options) {
            // Render options
            var settings = $.extend({
                //When the user checks the input
                onCheck: function (ele) {
                    return ele;
                },
                //When the user unchecks the input
                onUncheck: function (ele) {
                    return ele;
                }
            }, options);

            return this.each(function () {

                if (typeof $.fn.iCheck != 'undefined') {
                    $('input', this).on('ifChecked', function () {
                        var ele = $(this).parents("li").first();
                        ele.toggleClass("done");
                        settings.onCheck.call(ele);
                    });

                    $('input', this).on('ifUnchecked', function () {
                        var ele = $(this).parents("li").first();
                        ele.toggleClass("done");
                        settings.onUncheck.call(ele);
                    });
                } else {
                    $('input', this).on('change', function () {
                        var ele = $(this).parents("li").first();
                        ele.toggleClass("done");
                        if ($('input', ele).is(":checked")) {
                            settings.onCheck.call(ele);
                        } else {
                            settings.onUncheck.call(ele);
                        }
                    });
                }
            });
        };
    }(jQuery));
        /* The todo list plugin */
        $(".todo-list").todolist({
            onCheck: function (ele) {
                window.console.log("The element has been checked");
                return ele;
            },
            onUncheck: function (ele) {
                window.console.log("The element has been unchecked");
                return ele;
            }
        });


        //jQuery UI sortable for the todo list
        $(".todo-list").sortable({
            placeholder: "sort-highlight",
            handle: ".handle",
            forcePlaceholderSize: true,
            zIndex: 999999
        });
    </script>
}